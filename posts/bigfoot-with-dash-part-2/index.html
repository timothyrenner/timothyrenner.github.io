<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Finding Bigfoot with Dash, Part 2 | Timothy Renner</title><meta name=keywords content><meta name=description content="Building the plots necessary to find Bigfoot with Plotly&rsquo;s Dash framework.
Part 1: Map
Part 2: Plots
Part 3: Interactions
Warning
I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.
In particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well."><meta name=author content="Timothy Renner"><link rel=canonical href=https://timothyrenner.github.io/posts/bigfoot-with-dash-part-2/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://timothyrenner.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://timothyrenner.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://timothyrenner.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://timothyrenner.github.io/apple-touch-icon.png><link rel=mask-icon href=https://timothyrenner.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Finding Bigfoot with Dash, Part 2"><meta property="og:description" content="Building the plots necessary to find Bigfoot with Plotly&rsquo;s Dash framework.
Part 1: Map
Part 2: Plots
Part 3: Interactions
Warning
I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.
In particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well."><meta property="og:type" content="article"><meta property="og:url" content="https://timothyrenner.github.io/posts/bigfoot-with-dash-part-2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-09T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-09T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Finding Bigfoot with Dash, Part 2"><meta name=twitter:description content="Building the plots necessary to find Bigfoot with Plotly&rsquo;s Dash framework.
Part 1: Map
Part 2: Plots
Part 3: Interactions
Warning
I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.
In particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://timothyrenner.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Finding Bigfoot with Dash, Part 2","item":"https://timothyrenner.github.io/posts/bigfoot-with-dash-part-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Finding Bigfoot with Dash, Part 2","name":"Finding Bigfoot with Dash, Part 2","description":"Building the plots necessary to find Bigfoot with Plotly\u0026rsquo;s Dash framework.\nPart 1: Map\nPart 2: Plots\nPart 3: Interactions\nWarning\nI wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.\nIn particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well.","keywords":[],"articleBody":"Building the plots necessary to find Bigfoot with Plotly’s Dash framework.\nPart 1: Map\nPart 2: Plots\nPart 3: Interactions\nWarning\nI wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.\nIn particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well. Plotly Express makes generating the map easier too.\nIn part 1, I unveiled my latest plan to make one million dollars by finding Bigfoot using Plotly’s Dash framework. I walked through the overall structure of the app, the data, and the map visualization. In this part I’ll add some more plots to the layout - a line/scatter plot of sightings over time, a bar plot of the sightings by day of week, and a donut chart of the percentage of sightings for each sighting class. In part 3, I’ll wire the plots to an interactive element - a search bar that filters the titles. The final product will look like this:\nObviously I recommend reading part 1 of this series before this one, but it’s probably most important to read through the Dash user guide because I’m not going to explain everything in the code - only the parts that aren’t obvious. My goal isn’t to explain the elements of the framework, it’s to walk through a complete app and obviously make a million dollars.\nI’ll start by walking through the plots, then update the layout. The approach for the plots I’m taking is the same one I used for the map: write a function that takes all of the sightings and returns the data structure for the plot.\nSightings by Year Before building this plot I need to create a helper function that extracts the year from the timestamp. The timestamps are in ISO-8601 format, which means they look like this:\n2000-06-16T12:00:00Z It’s pretty easy to do this with the builtin Python datetime module. Put this function above the point where you read in the data (I’ll explain why that’s important in a minute).\nimport datetime as dt # This will get used more than once. TIMESTAMP_FORMAT = \"%Y-%m-%dT%H:%M:%SZ\" def sighting_year(sighting): return dt.datetime.strptime(sighting['timestamp'], TIMESTAMP_FORMAT).year All that function does is cast the string as a datetime object and extract the year. The reason I want this above the rest of the code is that there are a few sightings that really skew the axes on the time plot - one that super old, and another that’s hopefully been misrecorded as having happened in 2053. Revisiting the code where we read in the data, make the following change to take out the odd sightings out:\n# Read the data. fin = open('data/bfro_report_locations.csv','r') reader = DictReader(fin) BFRO_LOCATION_DATA = \\ [ line for line in reader ################################ NEW CODE ################################## if (sighting_year(line) \u003c= 2017) and (sighting_year(line) \u003e= 1900) ############################################################################ ] fin.close() Now that the dataset is a little cleaner it’s time to build the plot.\nfrom toolz import countby, first def bigfoot_by_year(sightings): # Create a dict mapping the # classification -\u003e [(year, count), (year, count) ... ] sightings_by_year = { classification: sorted( list( # Group by year -\u003e count. countby(sighting_year, class_sightings).items() ), # Sort by year. key=first ) for classification, class_sightings in groupby('classification', sightings).items() } # Build the plot with a dictionary. return { \"data\": [ { \"type\": \"scatter\", \"mode\": \"lines+markers\", \"name\": classification, \"x\": listpluck(0, class_sightings_by_year), \"y\": listpluck(1, class_sightings_by_year) } for classification, class_sightings_by_year in sightings_by_year.items() ], \"layout\": { \"title\": \"Sightings by Year\", \"showlegend\": False } } The real action in this function is building sightings_by_year. The data structure is a dictionary mapping the classification to a list of (year,count). To build it, I group by the classification. After that, for each classification do a count by year sorted by the year (sorted(... , key=first)).\nAs for the plot data structure it’s fairly straightforward - just put each class in a trace and pluck the zeroth element (year) for x and the first element (count) for y per trace. I decided not to show the legend because every plot gets the same color scheme and the map already has one.\nSightings by Day of Week As with the sightings by year plot, I’ll need a helper function to extract the day of the week from the report timestamp. I can use the same format string and just write a different helper.\ndef sighting_dow(sighting): return dt.datetime.strptime(sighting['timestamp'], TIMESTAMP_FORMAT)\\ .strftime(\"%a\") Since the datetime type doesn’t have an attribute with the day of the week I have to use strftime to get it, but other than that it’s basically the same function we have for extracting the year.\nThe plot will get built in two stages: first, group by the day of week, then build the data structure for the plot. I won’t worry about breaking this plot down by classification, but if you want to give it a shot it is fairly straightforward.\ndef bigfoot_dow(sightings): # Produces a dict dow =\u003e count. sightings_dow = countby(\"dow\", [ # Extract the day of week for each sighting - ignore the rest. { \"dow\": sighting_dow(sighting) } for sighting in sightings ] ) # Fix the order for the day of week axis. dows = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"] return { \"data\": [ { \"type\": \"bar\", \"x\": dows, # Get the count, or zero if it isn't present. \"y\": [get(d, sightings_dow, 0) for d in dows] } ], \"layout\": { \"title\": \"Sightings by Day of Week\" } } There are a couple of things to pay attention to in this function. The first is that I’ve fixed the order of the days of the week for the x axis, which ensures that the order is sane and consistent. When the interactions are added later, the order of the x axis won’t change even as the underlying data changes. The other is the get(d, sightings_dow, 0), which pulls the counts for the day of the week, or zero if it isn’t present. Again, that’s not a big deal now because we’re passing it all of the data, but when the interactions are added this will ensure that the function doesn’t throw an error if there isn’t an entry in sightings_dow.\nSightings by Classification This plot’s by far the simplest - it’s a donut chart of the classifications. There’s really nothing we haven’t seen before so I’ll just show it.\ndef bigfoot_class(sightings): sightings_by_class = countby(\"classification\", sightings) return { \"data\": [ { \"type\": \"pie\", \"labels\": list(sightings_by_class.keys()), \"values\": list(sightings_by_class.values()), \"hole\": 0.4 } ], \"layout\": { \"title\": \"Sightings by Class\" } } Layout Obviously the layout of the app is going to need to change before cramming the new plots in there. The code change for the layout is pretty serious, so I suggest nuking the old one and starting fresh. The layout I’m going for will have three rows (the final product will have four):\nTitle Map + Sightings by Day of Week Sightings by Year + Sightings by Class. Because the map and sightings by year plots are most important, I’m going to make them 8 units across. The other plots will be four units across (recall Bootstrap columns are subdivided into 12 units). Basically the layout will look like this:\nRow Column-12 (title) Row Column-8 (map) Column-4 (sightings by day of week) Row Column-8 (sightings per year) Column-4 (sightings by class) Hopefully with that 50,000 foot view the Python code won’t seem like a lot - it’s really easy to build incrementally as long as you’re consistent with your indentation.\napp.layout = html.Div([ # Row: Title html.Div([ # Column: Title html.Div([ html.H1(\"Bigfoot Sightings\", className=\"text-center\") ], className=\"col-md-12\") ], className=\"row\"), # Row: Map + DOW html.Div([ # Column: Map html.Div([ dcc.Graph( id=\"bigfoot-map\", figure=bigfoot_map(BFRO_LOCATION_DATA)) ], className=\"col-md-8\"), # Column: Day of Week html.Div([ dcc.Graph( id=\"bigfoot-dow\", figure=bigfoot_dow(BFRO_LOCATION_DATA)) ], className=\"col-md-4\") ], className=\"row\"), # Row: Year + Class html.Div([ # Column: Year html.Div([ dcc.Graph( id=\"bigfoot-by-year\", figure=bigfoot_by_year(BFRO_LOCATION_DATA)) ], className=\"col-md-8\"), # Column: Class html.Div([ dcc.Graph( id=\"bigfoot-class\", figure=bigfoot_class(BFRO_LOCATION_DATA)) ], className=\"col-md-4\") ], className=\"row\") ], className=\"container-fluid\") With the plots wired into the new layout, it’s time to fire this thing up. Run\npython app.py in the shell and hit localhost:8050 in the browser. You should see this:\nConclusion, Part 2 In this post I walked through several plotting functions, all of which have basically the same signature: take a list of dictionaries and return a dict with the “data” and “layout” fields needed to produce the plot in the browser. For most of the data manipulation I used functions from toolz, but it’s not terribly difficult to do the same thing with pandas. Hell, it might even be faster, but I’m not sure it would be noticeably faster. After building three additional plot functions, I modified the layout to take better advantage of the Bootstrap grid system and wired the plots into it.\nWe’re almost there, so it’s time to start thinking about what you’d do with a million dollars. There’s just one more thing to do: put that input bar together and wire it to the dataset for the interactions. That’s the sole topic of part 3.\nIf you’re impatient, the full source code for everything is already on GitHub.\nContinue on to part 3 to finish the app by adding an interactive search bar.\n","wordCount":"1547","inLanguage":"en","datePublished":"2022-08-09T00:00:00Z","dateModified":"2022-08-09T00:00:00Z","author":{"@type":"Person","name":"Timothy Renner"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://timothyrenner.github.io/posts/bigfoot-with-dash-part-2/"},"publisher":{"@type":"Organization","name":"Timothy Renner","logo":{"@type":"ImageObject","url":"https://timothyrenner.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://timothyrenner.github.io/ accesskey=h title="Timothy Renner (Alt + H)">Timothy Renner</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://timothyrenner.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://timothyrenner.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Finding Bigfoot with Dash, Part 2</h1><div class=post-meta><span title='2022-08-09 00:00:00 +0000 UTC'>August 9, 2022</span>&nbsp;·&nbsp;Timothy Renner</div></header><div class=post-content><p>Building the plots necessary to find Bigfoot with Plotly&rsquo;s Dash framework.</p><p><em><a href=https://timothyrenner.github.io/posts/bigfoot-with-dash-part-1/>Part 1: Map</a></em></p><p><strong><a href=https://timothyrenner.github.io/posts/bigfoot-with-dash-part-2/>Part 2: Plots</a></strong></p><p><em><a href=https://timothyrenner.github.io/posts/bigfoot-with-dash-part-3/>Part 3: Interactions</a></em></p><br><style type=text/css>.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media(prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice warning"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"/></svg></span>Warning</p><p>I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.</p><p>In particular, the <a href=https://dash-bootstrap-components.opensource.faculty.ai/>Dash Bootstrap Components</a> library replaces the manually set CSS classes and works really well. <a href=https://plotly.com/python/mapbox-layers/>Plotly Express</a> makes generating the map easier too.</p></div><p>In <a href=https://timothyrenner.github.io/posts/bigfoot-with-dash-part-1/>part 1</a>, I unveiled my latest plan to make <a href=http://www.wtae.com/article/the-hunt-for-bigfoot-in-crawford-county-pennsylvania/10227215>one million dollars by finding Bigfoot</a> using Plotly&rsquo;s <a href=https://plot.ly/products/dash/>Dash</a> framework.
I walked through the overall structure of the app, the data, and the map visualization.
In this part I&rsquo;ll add some more plots to the layout - a line/scatter plot of sightings over time, a bar plot of the sightings by day of week, and a donut chart of the percentage of sightings for each sighting class.
In part 3, I&rsquo;ll wire the plots to an interactive element - a search bar that filters the titles.
The final product will look like this:</p><figure><img loading=lazy src=/bigfoot-with-dash-part-2/bigfoot_dash_final.png></figure><p>Obviously I recommend reading part 1 of this series before this one, but it&rsquo;s probably most important to read through the <a href=https://plot.ly/dash/>Dash user guide</a> because I&rsquo;m not going to explain everything in the code - only the parts that aren&rsquo;t obvious.
My goal isn&rsquo;t to explain the elements of the framework, it&rsquo;s to walk through a complete app and obviously make a million dollars.</p><p>I&rsquo;ll start by walking through the plots, then update the layout.
The approach for the plots I&rsquo;m taking is the same one I used for the map: write a function that takes all of the sightings and returns the data structure for the plot.</p><h2 id=sightings-by-year>Sightings by Year<a hidden class=anchor aria-hidden=true href=#sightings-by-year>#</a></h2><p>Before building this plot I need to create a helper function that extracts the year from the timestamp.
The timestamps are in <a href=https://en.wikipedia.org/wiki/ISO_8601>ISO-8601</a> format, which means they look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>2000-06-16T12:00:00Z
</span></span></code></pre></div><p>It&rsquo;s pretty easy to do this with the builtin Python datetime module.
Put this function above the point where you read in the data (I&rsquo;ll explain why that&rsquo;s important in a minute).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> datetime <span style=color:#66d9ef>as</span> dt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This will get used more than once.</span>
</span></span><span style=display:flex><span>TIMESTAMP_FORMAT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>T%H:%M:%SZ&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>sighting_year</span>(sighting):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> dt<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>strptime(sighting[<span style=color:#e6db74>&#39;timestamp&#39;</span>], TIMESTAMP_FORMAT)<span style=color:#f92672>.</span>year
</span></span></code></pre></div><p>All that function does is cast the string as a datetime object and extract the year.
The reason I want this above the rest of the code is that there are a few sightings that really skew the axes on the time plot - one that super old, and another that&rsquo;s hopefully been misrecorded as having happened in 2053.
Revisiting the code where we read in the data, make the following change to take out the odd sightings out:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Read the data.</span>
</span></span><span style=display:flex><span>fin <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#39;data/bfro_report_locations.csv&#39;</span>,<span style=color:#e6db74>&#39;r&#39;</span>)
</span></span><span style=display:flex><span>reader <span style=color:#f92672>=</span> DictReader(fin)
</span></span><span style=display:flex><span>BFRO_LOCATION_DATA <span style=color:#f92672>=</span> \
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>    line <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> reader 
</span></span><span style=display:flex><span>    <span style=color:#75715e>################################ NEW CODE ##################################</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (sighting_year(line) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>2017</span>) <span style=color:#f92672>and</span> (sighting_year(line) <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>1900</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>############################################################################</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>fin<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p>Now that the dataset is a little cleaner it&rsquo;s time to build the plot.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> toolz <span style=color:#f92672>import</span> countby, first
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>bigfoot_by_year</span>(sightings):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create a dict mapping the </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># classification -&gt; [(year, count), (year, count) ... ]</span>
</span></span><span style=display:flex><span>    sightings_by_year <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        classification: 
</span></span><span style=display:flex><span>            sorted(
</span></span><span style=display:flex><span>                list(
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Group by year -&gt; count.</span>
</span></span><span style=display:flex><span>                    countby(sighting_year, class_sightings)<span style=color:#f92672>.</span>items()
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>                <span style=color:#75715e># Sort by year.</span>
</span></span><span style=display:flex><span>                key<span style=color:#f92672>=</span>first
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> classification, class_sightings 
</span></span><span style=display:flex><span>        <span style=color:#f92672>in</span> groupby(<span style=color:#e6db74>&#39;classification&#39;</span>, sightings)<span style=color:#f92672>.</span>items()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build the plot with a dictionary.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;data&#34;</span>: [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scatter&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;mode&#34;</span>: <span style=color:#e6db74>&#34;lines+markers&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;name&#34;</span>: classification,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;x&#34;</span>: listpluck(<span style=color:#ae81ff>0</span>, class_sightings_by_year),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;y&#34;</span>: listpluck(<span style=color:#ae81ff>1</span>, class_sightings_by_year)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> classification, class_sightings_by_year 
</span></span><span style=display:flex><span>            <span style=color:#f92672>in</span> sightings_by_year<span style=color:#f92672>.</span>items()
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;layout&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Sightings by Year&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;showlegend&#34;</span>: <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>The real action in this function is building <code>sightings_by_year</code>.
The data structure is a dictionary mapping the classification to a list of <code>(year,count)</code>.
To build it, I group by the classification.
After that, for each classification do a count by year sorted by the year (<code>sorted(... , key=first)</code>).</p><p>As for the plot data structure it&rsquo;s fairly straightforward - just put each class in a trace and pluck the zeroth element (year) for x and the first element (count) for y per trace.
I decided not to show the legend because every plot gets the same color scheme and the map already has one.</p><h2 id=sightings-by-day-of-week>Sightings by Day of Week<a hidden class=anchor aria-hidden=true href=#sightings-by-day-of-week>#</a></h2><p>As with the sightings by year plot, I&rsquo;ll need a helper function to extract the day of the week from the report timestamp.
I can use the same format string and just write a different helper.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>sighting_dow</span>(sighting):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> dt<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>strptime(sighting[<span style=color:#e6db74>&#39;timestamp&#39;</span>], TIMESTAMP_FORMAT)\
</span></span><span style=display:flex><span>                      <span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%a</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><p>Since the datetime type doesn&rsquo;t have an attribute with the day of the week I have to use <code>strftime</code> to get it, but other than that it&rsquo;s basically the same function we have for extracting the year.</p><p>The plot will get built in two stages: first, group by the day of week, then build the data structure for the plot.
I won&rsquo;t worry about breaking this plot down by classification, but if you want to give it a shot it is fairly straightforward.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>bigfoot_dow</span>(sightings):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Produces a dict dow =&gt; count.</span>
</span></span><span style=display:flex><span>    sightings_dow <span style=color:#f92672>=</span> countby(<span style=color:#e6db74>&#34;dow&#34;</span>,
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            <span style=color:#75715e># Extract the day of week for each sighting - ignore the rest.</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;dow&#34;</span>: sighting_dow(sighting)
</span></span><span style=display:flex><span>            } 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> sighting <span style=color:#f92672>in</span> sightings
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Fix the order for the day of week axis.</span>
</span></span><span style=display:flex><span>    dows <span style=color:#f92672>=</span>  [<span style=color:#e6db74>&#34;Sun&#34;</span>, <span style=color:#e6db74>&#34;Mon&#34;</span>, <span style=color:#e6db74>&#34;Tue&#34;</span>, <span style=color:#e6db74>&#34;Wed&#34;</span>, <span style=color:#e6db74>&#34;Thu&#34;</span>, <span style=color:#e6db74>&#34;Fri&#34;</span>, <span style=color:#e6db74>&#34;Sat&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;data&#34;</span>: [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;bar&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;x&#34;</span>: dows,
</span></span><span style=display:flex><span>                <span style=color:#75715e># Get the count, or zero if it isn&#39;t present.</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;y&#34;</span>: [get(d, sightings_dow, <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>for</span> d <span style=color:#f92672>in</span> dows]
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;layout&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Sightings by Day of Week&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>There are a couple of things to pay attention to in this function.
The first is that I&rsquo;ve fixed the order of the days of the week for the x axis, which ensures that the order is sane and consistent.
When the interactions are added later, the order of the x axis won&rsquo;t change even as the underlying data changes.
The other is the <code>get(d, sightings_dow, 0)</code>, which pulls the counts for the day of the week, or zero if it isn&rsquo;t present.
Again, that&rsquo;s not a big deal <em>now</em> because we&rsquo;re passing it all of the data, but when the interactions are added this will ensure that the function doesn&rsquo;t throw an error if there isn&rsquo;t an entry in <code>sightings_dow</code>.</p><h2 id=sightings-by-classification>Sightings by Classification<a hidden class=anchor aria-hidden=true href=#sightings-by-classification>#</a></h2><p>This plot&rsquo;s by far the simplest - it&rsquo;s a donut chart of the classifications.
There&rsquo;s really nothing we haven&rsquo;t seen before so I&rsquo;ll just show it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>bigfoot_class</span>(sightings):
</span></span><span style=display:flex><span>    sightings_by_class <span style=color:#f92672>=</span> countby(<span style=color:#e6db74>&#34;classification&#34;</span>, sightings)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;data&#34;</span>: [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;pie&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;labels&#34;</span>: list(sightings_by_class<span style=color:#f92672>.</span>keys()),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;values&#34;</span>: list(sightings_by_class<span style=color:#f92672>.</span>values()),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;hole&#34;</span>: <span style=color:#ae81ff>0.4</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;layout&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Sightings by Class&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h2 id=layout>Layout<a hidden class=anchor aria-hidden=true href=#layout>#</a></h2><p>Obviously the layout of the app is going to need to change before cramming the new plots in there.
The code change for the layout is pretty serious, so I suggest nuking the old one and starting fresh.
The layout I&rsquo;m going for will have three rows (the final product will have four):</p><ol><li>Title</li><li>Map + Sightings by Day of Week</li><li>Sightings by Year + Sightings by Class.</li></ol><p>Because the map and sightings by year plots are most important, I&rsquo;m going to make them 8 units across.
The other plots will be four units across (recall Bootstrap columns are subdivided into 12 units).
Basically the layout will look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Row
</span></span><span style=display:flex><span>    Column-12 (title)
</span></span><span style=display:flex><span>Row
</span></span><span style=display:flex><span>    Column-8 (map)
</span></span><span style=display:flex><span>    Column-4 (sightings by day of week)
</span></span><span style=display:flex><span>Row
</span></span><span style=display:flex><span>    Column-8 (sightings per year)
</span></span><span style=display:flex><span>    Column-4 (sightings by class)
</span></span></code></pre></div><p>Hopefully with that 50,000 foot view the Python code won&rsquo;t seem like a lot - it&rsquo;s really easy to build incrementally as long as you&rsquo;re consistent with your indentation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>layout <span style=color:#f92672>=</span> html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Title</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Title</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>H1(<span style=color:#e6db74>&#34;Bigfoot Sightings&#34;</span>, className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-center&#34;</span>)
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-12&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Map + DOW</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Map</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-map&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_map(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-8&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Day of Week</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-dow&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_dow(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-4&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Year + Class</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Year</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-by-year&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_by_year(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-8&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Class</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-class&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_class(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-4&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>)
</span></span><span style=display:flex><span>], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container-fluid&#34;</span>)
</span></span></code></pre></div><p>With the plots wired into the new layout, it&rsquo;s time to fire this thing up.
Run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>python app.py
</span></span></code></pre></div><p>in the shell and hit <code>localhost:8050</code> in the browser.
You should see this:</p><figure><img loading=lazy src=/bigfoot-with-dash-part-2/bigfoot_dash_plots.png></figure><h2 id=conclusion-part-2>Conclusion, Part 2<a hidden class=anchor aria-hidden=true href=#conclusion-part-2>#</a></h2><p>In this post I walked through several plotting functions, all of which have basically the same signature: take a list of dictionaries and return a dict with the &ldquo;data&rdquo; and &ldquo;layout&rdquo; fields needed to produce the plot in the browser.
For most of the data manipulation I used functions from toolz, but it&rsquo;s not terribly difficult to do the same thing with pandas.
Hell, it might even be faster, but I&rsquo;m not sure it would be <em>noticeably</em> faster.
After building three additional plot functions, I modified the layout to take better advantage of the Bootstrap grid system and wired the plots into it.</p><p>We&rsquo;re almost there, so it&rsquo;s time to start thinking about what you&rsquo;d do with a million dollars.
There&rsquo;s just one more thing to do: put that input bar together and wire it to the dataset for the interactions.
That&rsquo;s the sole topic of part 3.</p><p>If you&rsquo;re impatient, the full source code for everything is already on <a href=https://github.com/timothyrenner/bigfoot-dash-app>GitHub</a>.</p><p>Continue on to <a href=https://timothyrenner.github.io/posts/bigfoot-with-dash-part-3/>part 3</a> to finish the app by adding an interactive search bar.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://timothyrenner.github.io/>Timothy Renner</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>