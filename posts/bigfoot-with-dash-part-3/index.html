<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Finding Bigfoot with Dash, Part 3 | Timothy Renner</title><meta name=keywords content><meta name=description content="Adding a search bar to the Bigfoot report titles and wiring it to the sightings map and plots.
Part 1: Map
Part 2: Plots
Part 3: Interactions
Warning
I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.
In particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well."><meta name=author content="Timothy Renner"><link rel=canonical href=https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-3/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.timothyrenner.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.timothyrenner.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.timothyrenner.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://www.timothyrenner.github.io/apple-touch-icon.png><link rel=mask-icon href=https://www.timothyrenner.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Finding Bigfoot with Dash, Part 3"><meta property="og:description" content="Adding a search bar to the Bigfoot report titles and wiring it to the sightings map and plots.
Part 1: Map
Part 2: Plots
Part 3: Interactions
Warning
I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.
In particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well."><meta property="og:type" content="article"><meta property="og:url" content="https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-10T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Finding Bigfoot with Dash, Part 3"><meta name=twitter:description content="Adding a search bar to the Bigfoot report titles and wiring it to the sightings map and plots.
Part 1: Map
Part 2: Plots
Part 3: Interactions
Warning
I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.
In particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.timothyrenner.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Finding Bigfoot with Dash, Part 3","item":"https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Finding Bigfoot with Dash, Part 3","name":"Finding Bigfoot with Dash, Part 3","description":"Adding a search bar to the Bigfoot report titles and wiring it to the sightings map and plots.\nPart 1: Map\nPart 2: Plots\nPart 3: Interactions\nWarning\nI wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.\nIn particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well.","keywords":[],"articleBody":"Adding a search bar to the Bigfoot report titles and wiring it to the sightings map and plots.\nPart 1: Map\nPart 2: Plots\nPart 3: Interactions\nWarning\nI wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.\nIn particular, the Dash Bootstrap Components library replaces the manually set CSS classes and works really well. Plotly Express makes generating the map easier too.\nThis is it, the final piece of the puzzle. The answer to questions no one thought to ask. The key to unlocking the sasquatch mystery.\nMaybe.\nThis is part 3 of the details of my latest plan to make one million dollars by finding Bigfoot using Plotly’s Dash framework. I walked through the app structure and the interactive map in part 1. In part 2 I added a few more plots and made a more complicated layout. In this part I’ll add a search bar that filters the data in all of the plots using the text in the title and the real magic of the Dash framework: the callback decorator.\nInput Bar The first order of business is to add the input bar to the layout. I’ll also go ahead and add links to the data sources to the same row. The rest of the layout is unchanged at the moment.\napp.layout = html.Div([ # Row: Title html.Div([ # Column: Title html.Div([ html.H1(\"Bigfoot Sightings\", className=\"text-center\") ], className=\"col-md-12\") ], className=\"row\"), ############################################################################ # NEW CODE ############################################################################ # Row: Input Bar + References html.Div([ # Column: Input Bar html.Div([ html.P([ html.B(\"Filter the titles: \"), dcc.Input( placeholder=\"Try 'heard'\", id=\"bigfoot-text-filter\", value=\"\") ]), ], className=\"col-md-6\"), # Column: References. html.Div([ html.P([ \"Data pulled from \", html.A(\"bfro.net\", href=\"http://www.bfro.net/\"), \". Grab it at \", html.A(\"data.world\", href=\"https://data.world/timothyrenner/bfro-sightings-data\"), \".\" ], style={\"text-align\": \"right\"}) ], className=\"col-md-6\") ], className=\"row\"), ############################################################################ # Row: Map + DOW html.Div([ # Column: Map html.Div([ dcc.Graph( id=\"bigfoot-map\", figure=bigfoot_map(BFRO_LOCATION_DATA)) ], className=\"col-md-8\"), # Column: Day of Week html.Div([ dcc.Graph( id=\"bigfoot-dow\", figure=bigfoot_dow(BFRO_LOCATION_DATA)) ], className=\"col-md-4\") ], className=\"row\"), # Row: Year + Class html.Div([ # Column: Year html.Div([ dcc.Graph( id=\"bigfoot-by-year\", figure=bigfoot_by_year(BFRO_LOCATION_DATA)) ], className=\"col-md-8\"), # Column: Class html.Div([ dcc.Graph( id=\"bigfoot-class\", figure=bigfoot_class(BFRO_LOCATION_DATA)) ], className=\"col-md-4\") ], className=\"row\") ], className=\"container-fluid\") The search bar is a Dash Input component, but it isn’t wired to anything. If I fired up the app right now it would show up, and that’s about it. The server’s going to need a little work to make the magic happen.\nFilter Function The first thing the server’s going to need is a function that will filter the sightings data for us. Since the goal is to filter all of the data feeding the plots, it makes sense to write the function once and use it to filter the data before sending it to the individual plotting functions. This realization may or may not have come to me after I already wrote the same thing four times. Anyway, here’s what that function should look like:\n# Compose list with filter using toolz. listfilter = compose(list, filter) def filter_sightings(filter_text): return listfilter( lambda x: filter_text.lower() in x['title'].lower(), BFRO_LOCATION_DATA ) This function takes some text and performs a substring search against the titles in BFRO_LOCATION_DATA, making sure everything’s in lower case so the search isn’t case sensitive. A more sophisticated version might use some sort of index or fuzzy matching or even a little NLP, but a substring search is a good start. One thing to notice is that the function closes around the BFRO_LOCATION_DATA variable, which is effectively in global scope for the application. This isn’t a problem because I don’t ever ever ever ever modify it. Once it’s initialized, it’s a constant.\nCallbacks It’s time to put the input bar and filter function to good use. There’s one last modification I’ll need to make to the layout: remove the figure attribute from the dcc.Graph components.\napp.layout = html.Div([ # Row: Title html.Div([ # Column: Title html.Div([ html.H1(\"Bigfoot Sightings\", className=\"text-center\") ], className=\"col-md-12\") ], className=\"row\"), # Row: Input Bar + References html.Div([ # Column: Input Bar html.Div([ html.P([ html.B(\"Filter the titles: \"), dcc.Input( placeholder=\"Try 'heard'\", id=\"bigfoot-text-filter\", value=\"\") ]), ], className=\"col-md-6\"), # Column: References. html.Div([ html.P([ \"Data pulled from \", html.A(\"bfro.net\", href=\"http://www.bfro.net/\"), \". Grab it at \", html.A(\"data.world\", href=\"https://data.world/timothyrenner/bfro-sightings-data\"), \".\" ], style={\"text-align\": \"right\"}) ], className=\"col-md-6\") ], className=\"row\"), # Row: Map + DOW html.Div([ # Column: Map html.Div([ dcc.Graph( id=\"bigfoot-map\" ], className=\"col-md-8\"), # Column: Day of Week html.Div([ dcc.Graph( id=\"bigfoot-dow\" ], className=\"col-md-4\") ], className=\"row\"), # Row: Year + Class html.Div([ # Column: Year html.Div([ dcc.Graph( id=\"bigfoot-by-year\" ], className=\"col-md-8\"), # Column: Class html.Div([ dcc.Graph( id=\"bigfoot-class\" ], className=\"col-md-4\") ], className=\"row\") ], className=\"container-fluid\") What I’m going to do next is wire the figure attribute of those components to the values returned by the callbacks, rather than having them statically built when the server starts. Because the interaction is fairly straightforward - read the input and filter the data by title - the callbacks themselves aren’t complicated.\n@app.callback( Output('bigfoot-map', 'figure'), [ Input('bigfoot-text-filter', 'value') ] ) def filter_bigfoot_map(filter_text): return bigfoot_map(filter_sightings(filter_text)) @app.callback( Output('bigfoot-by-year', 'figure'), [ Input('bigfoot-text-filter', 'value') ] ) def filter_bigfoot_by_year(filter_text): return bigfoot_by_year(filter_sightings(filter_text)) @app.callback( Output('bigfoot-dow', 'figure'), [ Input('bigfoot-text-filter', 'value') ] ) def filter_bigfoot_dow(filter_text): return bigfoot_dow(filter_sightings(filter_text)) @app.callback( Output('bigfoot-class', 'figure'), [ Input('bigfoot-text-filter', 'value') ] ) def filter_bigfoot_class(filter_text): return bigfoot_class(filter_sightings(filter_text)) Each of these functions works exactly the same way:\nGet the input from the text filter’s value property. Filter the reports with the filter_sightings function based on the callback input. Return the plot, sending the output to the figure property of the corresponding graph in the layout. Here’s what makes the Dash framework truly excellent in my opinion: effectively every thing I’ve written for this application down to the interaction callbacks is a testable, reusable piece of logic. The interactions aren’t done by binding specialized functions to fields in some data structure; they’re done by decorating a plain-ass Python function that, by itself, is useful code. In fact, the vast majority of the code in this app could easily have come from some module that was originally built for, say, an analysis notebook. It’s only the layout and callback decorators that are specific to Dash, not the entire app’s code base.\nAnyway, enough gushing. If you fire up the app, it will work. It’s got all of the plots, all of the data, and all of the interactions. It looks like this:\nThere’s one more improvement to be made, however. It’s probably pretty minor because there isn’t much data, but it was bugging me when I was putting this thing together. You may have noticed that the filter_sightings function gets called four times with every callback. The callbacks themselves are invoked every time the user types a character in the input bar. If I can save the value of the filtered reports and send that to all of the plot function callbacks, then I only need to loop over that array once. That’s what caching’s for.\nFilter Function Again The particular type of caching that works best here is called “memoization”, and the way it works is straightforward: when a memoized function is called, the inputs are mapped to the outputs and the map is stored in memory. If the function called again with that same input, it doesn’t need to be recomputed - the value can be returned outright because it’s stored. A function call turns into a lookup. Note that this only works for functions that are free of side effects and return the same output every time the function is called.\nAs I’ve already said, memoizing the filter_sightings function might get us a little more performance, or we might not notice. Either way it can’t hurt. Caching in Dash can be easily added with the flask-caching module because Dash is built on top of Flask.\nThis will require one additional installation:\npip install flask-caching It’s also going to require initializing the cache and attaching it to the app server. Revisiting the original app initialization code:\nimport dash #################################### NEW CODE ################################## from flask_caching import Cache ################################################################################ app = dash.Dash() # Title the app. app.title = \"Bigfoot Sightings\" #################################### NEW CODE ################################## cache = Cache(app.server, config={\"CACHE_TYPE\": \"simple\"}) ################################################################################ The Flask server lives inside the server attribute of the Dash object. All I have to do is initialize the cache and pass it the underlying server and we’re ready to memoize our filter function.\n# Compose list with filter using toolz. listfilter = compose(list, filter) #################################### NEW CODE ################################## @cache.memoize(10) # Ten second timeout. ################################################################################ def filter_sightings(filter_text): return listfilter( lambda x: filter_text.lower() in x['title'].lower(), BFRO_LOCATION_DATA ) That’s it. Decorate the function with @cache.memoize(10) and the cache will remember input-\u003eoutput mappings for 10 seconds before expiring them. You can fire up the app again to make sure it works, but this time all of the changes were internal. Odds are the caching didn’t make a huge difference but it did provide me the opportunity to learn how to use it.\nConclusion, Part 3 And that’s it! In this part I added the search bar to the map, bar chart, line/scatter plot, and donut chart with a pretty small code change. Overall this is what I like most about the framework: the ability to get an app ready to run and easily make incremental improvements, all while keeping the code factored into manageable and often reusable chunks.\nAlso I wrote zero Javascript.\nIf you want to see the whole thing together in one script, the full source code for everything is already on GitHub.\nThat’s it - we’re ready to rock. Happy hunting.\n","wordCount":"1581","inLanguage":"en","datePublished":"2022-08-10T00:00:00Z","dateModified":"2022-08-10T00:00:00Z","author":{"@type":"Person","name":"Timothy Renner"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-3/"},"publisher":{"@type":"Organization","name":"Timothy Renner","logo":{"@type":"ImageObject","url":"https://www.timothyrenner.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.timothyrenner.github.io/ accesskey=h title="Timothy Renner (Alt + H)">Timothy Renner</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.timothyrenner.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://www.timothyrenner.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Finding Bigfoot with Dash, Part 3</h1><div class=post-meta><span title='2022-08-10 00:00:00 +0000 UTC'>August 10, 2022</span>&nbsp;·&nbsp;Timothy Renner</div></header><div class=post-content><p>Adding a search bar to the Bigfoot report titles and wiring it to the sightings map and plots.</p><p><em><a href=https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-1/>Part 1: Map</a></em></p><p><em><a href=https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-2/>Part 2: Plots</a></em></p><p><strong><a href=https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-3/>Part 3: Interactions</a></strong></p><br><style type=text/css>.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media(prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice warning"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"/></svg></span>Warning</p><p>I wrote this when Plotly Dash was brand new. Though the fundamental process and setup is the same, some of the details are quite a bit simpler now than they were when I wrote this.</p><p>In particular, the <a href=https://dash-bootstrap-components.opensource.faculty.ai/>Dash Bootstrap Components</a> library replaces the manually set CSS classes and works really well. <a href=https://plotly.com/python/mapbox-layers/>Plotly Express</a> makes generating the map easier too.</p></div><p>This is it, the final piece of the puzzle.
The answer to questions no one thought to ask.
The key to unlocking the sasquatch mystery.</p><p>Maybe.</p><p>This is part 3 of the details of my latest plan to make <a href=http://www.wtae.com/article/the-hunt-for-bigfoot-in-crawford-county-pennsylvania/10227215>one million dollars by finding Bigfoot</a> using Plotly&rsquo;s <a href=https://plot.ly/products/dash/>Dash</a> framework.
I walked through the app structure and the interactive map in <a href=https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-1/>part 1</a>.
In <a href=https://www.timothyrenner.github.io/posts/bigfoot-with-dash-part-2/>part 2</a> I added a few more plots and made a more complicated layout.
In this part I&rsquo;ll add a search bar that filters the data in all of the plots using the text in the title and the real magic of the Dash framework: the callback decorator.</p><h2 id=input-bar>Input Bar<a hidden class=anchor aria-hidden=true href=#input-bar>#</a></h2><p>The first order of business is to add the input bar to the layout.
I&rsquo;ll also go ahead and add links to the data sources to the same row.
The rest of the layout is unchanged at the moment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>layout <span style=color:#f92672>=</span> html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Title</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Title</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>H1(<span style=color:#e6db74>&#34;Bigfoot Sightings&#34;</span>, className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-center&#34;</span>)
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-12&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e>############################################################################</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># NEW CODE</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>############################################################################</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Input Bar + References</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Input Bar</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>P([
</span></span><span style=display:flex><span>                html<span style=color:#f92672>.</span>B(<span style=color:#e6db74>&#34;Filter the titles:  &#34;</span>),
</span></span><span style=display:flex><span>                dcc<span style=color:#f92672>.</span>Input(
</span></span><span style=display:flex><span>                    placeholder<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Try &#39;heard&#39;&#34;</span>,
</span></span><span style=display:flex><span>                    id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-text-filter&#34;</span>,
</span></span><span style=display:flex><span>                    value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            ]),
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-6&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: References.</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>P([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;Data pulled from &#34;</span>,
</span></span><span style=display:flex><span>                html<span style=color:#f92672>.</span>A(<span style=color:#e6db74>&#34;bfro.net&#34;</span>, href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.bfro.net/&#34;</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;. Grab it at &#34;</span>,
</span></span><span style=display:flex><span>                html<span style=color:#f92672>.</span>A(<span style=color:#e6db74>&#34;data.world&#34;</span>,
</span></span><span style=display:flex><span>                       href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://data.world/timothyrenner/bfro-sightings-data&#34;</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;.&#34;</span>
</span></span><span style=display:flex><span>            ], style<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;text-align&#34;</span>: <span style=color:#e6db74>&#34;right&#34;</span>})
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-6&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e>############################################################################</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Map + DOW</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Map</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-map&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_map(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-8&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Day of Week</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-dow&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_dow(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-4&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Year + Class</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Year</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-by-year&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_by_year(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-8&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Class</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-class&#34;</span>,
</span></span><span style=display:flex><span>                figure<span style=color:#f92672>=</span>bigfoot_class(BFRO_LOCATION_DATA))
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-4&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>)
</span></span><span style=display:flex><span>], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container-fluid&#34;</span>)
</span></span></code></pre></div><p>The search bar is a Dash <code>Input</code> component, but it isn&rsquo;t wired to anything.
If I fired up the app right now it would show up, and that&rsquo;s about it.
The server&rsquo;s going to need a little work to make the magic happen.</p><h2 id=filter-function>Filter Function<a hidden class=anchor aria-hidden=true href=#filter-function>#</a></h2><p>The first thing the server&rsquo;s going to need is a function that will filter the sightings data for us.
Since the goal is to filter <em>all</em> of the data feeding the plots, it makes sense to write the function once and use it to filter the data before sending it to the individual plotting functions.
This realization may or may not have come to me after I already wrote the same thing four times.
Anyway, here&rsquo;s what that function should look like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Compose list with filter using toolz.</span>
</span></span><span style=display:flex><span>listfilter <span style=color:#f92672>=</span> compose(list, filter)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_sightings</span>(filter_text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> listfilter(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>lambda</span> x: filter_text<span style=color:#f92672>.</span>lower() <span style=color:#f92672>in</span> x[<span style=color:#e6db74>&#39;title&#39;</span>]<span style=color:#f92672>.</span>lower(),
</span></span><span style=display:flex><span>            BFRO_LOCATION_DATA
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p>This function takes some text and performs a substring search against the titles in <code>BFRO_LOCATION_DATA</code>, making sure everything&rsquo;s in lower case so the search isn&rsquo;t case sensitive.
A more sophisticated version might use some sort of index or fuzzy matching or even a little NLP, but a substring search is a good start.
One thing to notice is that the function closes around the <code>BFRO_LOCATION_DATA</code> variable, which is effectively in global scope for the application.
This isn&rsquo;t a problem because I don&rsquo;t ever ever ever ever modify it.
Once it&rsquo;s initialized, it&rsquo;s a constant.</p><h2 id=callbacks>Callbacks<a hidden class=anchor aria-hidden=true href=#callbacks>#</a></h2><p>It&rsquo;s time to put the input bar and filter function to good use.
There&rsquo;s one last modification I&rsquo;ll need to make to the layout: remove the <code>figure</code> attribute from the <code>dcc.Graph</code> components.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>layout <span style=color:#f92672>=</span> html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Title</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Title</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>H1(<span style=color:#e6db74>&#34;Bigfoot Sightings&#34;</span>, className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-center&#34;</span>)
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-12&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Input Bar + References</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Input Bar</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>P([
</span></span><span style=display:flex><span>                html<span style=color:#f92672>.</span>B(<span style=color:#e6db74>&#34;Filter the titles:  &#34;</span>),
</span></span><span style=display:flex><span>                dcc<span style=color:#f92672>.</span>Input(
</span></span><span style=display:flex><span>                    placeholder<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Try &#39;heard&#39;&#34;</span>,
</span></span><span style=display:flex><span>                    id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-text-filter&#34;</span>,
</span></span><span style=display:flex><span>                    value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            ]),
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-6&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: References.</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            html<span style=color:#f92672>.</span>P([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;Data pulled from &#34;</span>,
</span></span><span style=display:flex><span>                html<span style=color:#f92672>.</span>A(<span style=color:#e6db74>&#34;bfro.net&#34;</span>, href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.bfro.net/&#34;</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;. Grab it at &#34;</span>,
</span></span><span style=display:flex><span>                html<span style=color:#f92672>.</span>A(<span style=color:#e6db74>&#34;data.world&#34;</span>, 
</span></span><span style=display:flex><span>                       href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://data.world/timothyrenner/bfro-sightings-data&#34;</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;.&#34;</span>
</span></span><span style=display:flex><span>            ], style<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;text-align&#34;</span>: <span style=color:#e6db74>&#34;right&#34;</span>})
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-6&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Map + DOW</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Map</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-map&#34;</span>
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-8&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Day of Week</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-dow&#34;</span>
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-4&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#75715e># Row: Year + Class</span>
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Year</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-by-year&#34;</span>
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-8&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e># Column: Class</span>
</span></span><span style=display:flex><span>        html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>            dcc<span style=color:#f92672>.</span>Graph(
</span></span><span style=display:flex><span>                id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bigfoot-class&#34;</span>
</span></span><span style=display:flex><span>        ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-4&#34;</span>)
</span></span><span style=display:flex><span>    ], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>)
</span></span><span style=display:flex><span>], className<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container-fluid&#34;</span>)
</span></span></code></pre></div><p>What I&rsquo;m going to do next is wire the <code>figure</code> attribute of those components to the values returned by the callbacks, rather than having them statically built when the server starts.
Because the interaction is fairly straightforward - read the input and filter the data by title - the callbacks themselves aren&rsquo;t complicated.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.callback</span>(
</span></span><span style=display:flex><span>    Output(<span style=color:#e6db74>&#39;bigfoot-map&#39;</span>, <span style=color:#e6db74>&#39;figure&#39;</span>),
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        Input(<span style=color:#e6db74>&#39;bigfoot-text-filter&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_bigfoot_map</span>(filter_text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bigfoot_map(filter_sightings(filter_text))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.callback</span>(
</span></span><span style=display:flex><span>    Output(<span style=color:#e6db74>&#39;bigfoot-by-year&#39;</span>, <span style=color:#e6db74>&#39;figure&#39;</span>),
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        Input(<span style=color:#e6db74>&#39;bigfoot-text-filter&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_bigfoot_by_year</span>(filter_text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bigfoot_by_year(filter_sightings(filter_text))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.callback</span>(
</span></span><span style=display:flex><span>    Output(<span style=color:#e6db74>&#39;bigfoot-dow&#39;</span>, <span style=color:#e6db74>&#39;figure&#39;</span>),
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        Input(<span style=color:#e6db74>&#39;bigfoot-text-filter&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_bigfoot_dow</span>(filter_text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bigfoot_dow(filter_sightings(filter_text))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.callback</span>(
</span></span><span style=display:flex><span>    Output(<span style=color:#e6db74>&#39;bigfoot-class&#39;</span>, <span style=color:#e6db74>&#39;figure&#39;</span>),
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        Input(<span style=color:#e6db74>&#39;bigfoot-text-filter&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_bigfoot_class</span>(filter_text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bigfoot_class(filter_sightings(filter_text))
</span></span></code></pre></div><p>Each of these functions works exactly the same way:</p><ol><li>Get the input from the text filter&rsquo;s <code>value</code> property.</li><li>Filter the reports with the <code>filter_sightings</code> function based on the callback input.</li><li>Return the plot, sending the output to the <code>figure</code> property of the corresponding graph in the layout.</li></ol><p>Here&rsquo;s what makes the Dash framework truly excellent in my opinion: effectively every thing I&rsquo;ve written for this application down to the interaction callbacks is a testable, reusable piece of logic.
The interactions aren&rsquo;t done by binding specialized functions to fields in some data structure; they&rsquo;re done by decorating a plain-ass Python function that, by itself, is useful code.
In fact, the vast majority of the code in this app could easily have come from some module that was originally built for, say, an analysis notebook.
It&rsquo;s only the layout and callback <em>decorators</em> that are specific to Dash, not the entire app&rsquo;s code base.</p><p>Anyway, enough gushing.
If you fire up the app, it will work.
It&rsquo;s got all of the plots, all of the data, and all of the interactions.
It looks like this:</p><figure><img loading=lazy src=/bigfoot-with-dash-part-2/bigfoot_dash_final.png></figure><p>There&rsquo;s one more improvement to be made, however.
It&rsquo;s probably pretty minor because there isn&rsquo;t much data, but it was bugging me when I was putting this thing together.
You may have noticed that the <code>filter_sightings</code> function gets called four times with every callback.
The callbacks themselves are invoked every time the user types a character in the input bar.
If I can save the value of the filtered reports and send <em>that</em> to all of the plot function callbacks, then I only need to loop over that array once.
That&rsquo;s what caching&rsquo;s for.</p><h2 id=filter-function-again>Filter Function Again<a hidden class=anchor aria-hidden=true href=#filter-function-again>#</a></h2><p>The particular type of caching that works best here is called &ldquo;memoization&rdquo;, and the way it works is straightforward: when a memoized function is called, the inputs are mapped to the outputs and the map is stored in memory.
If the function called again with that same input, it doesn&rsquo;t need to be recomputed - the value can be returned outright because it&rsquo;s stored.
A function call turns into a lookup.
<em>Note that this only works for functions that are free of side effects and return the same output every time the function is called.</em></p><p>As I&rsquo;ve already said, memoizing the <code>filter_sightings</code> function <em>might</em> get us a little more performance, or we might not notice.
Either way it can&rsquo;t hurt.
Caching in Dash can be easily added with the <code>flask-caching</code> module because Dash is built on top of Flask.</p><p>This will require one additional installation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>pip install flask-caching
</span></span></code></pre></div><p>It&rsquo;s also going to require initializing the cache and attaching it to the app server.
Revisiting the original app initialization code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> dash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################### NEW CODE ##################################</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask_caching <span style=color:#f92672>import</span> Cache
</span></span><span style=display:flex><span><span style=color:#75715e>################################################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> dash<span style=color:#f92672>.</span>Dash()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Title the app.</span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Bigfoot Sightings&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################### NEW CODE ##################################</span>
</span></span><span style=display:flex><span>cache <span style=color:#f92672>=</span> Cache(app<span style=color:#f92672>.</span>server, config<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;CACHE_TYPE&#34;</span>: <span style=color:#e6db74>&#34;simple&#34;</span>})
</span></span><span style=display:flex><span><span style=color:#75715e>################################################################################</span>
</span></span></code></pre></div><p>The Flask server lives inside the <code>server</code> attribute of the <code>Dash</code> object.
All I have to do is initialize the cache and pass it the underlying server and we&rsquo;re ready to memoize our filter function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Compose list with filter using toolz.</span>
</span></span><span style=display:flex><span>listfilter <span style=color:#f92672>=</span> compose(list, filter)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################### NEW CODE ##################################</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@cache.memoize</span>(<span style=color:#ae81ff>10</span>) <span style=color:#75715e># Ten second timeout.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>################################################################################</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_sightings</span>(filter_text):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> listfilter(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>lambda</span> x: filter_text<span style=color:#f92672>.</span>lower() <span style=color:#f92672>in</span> x[<span style=color:#e6db74>&#39;title&#39;</span>]<span style=color:#f92672>.</span>lower(),
</span></span><span style=display:flex><span>            BFRO_LOCATION_DATA
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p>That&rsquo;s it.
Decorate the function with <code>@cache.memoize(10)</code> and the cache will remember input->output mappings for 10 seconds before expiring them.
You can fire up the app again to make sure it works, but this time all of the changes were internal.
Odds are the caching didn&rsquo;t make a <em>huge</em> difference but it did provide me the opportunity to learn how to use it.</p><h2 id=conclusion-part-3>Conclusion, Part 3<a hidden class=anchor aria-hidden=true href=#conclusion-part-3>#</a></h2><p>And that&rsquo;s it!
In this part I added the search bar to the map, bar chart, line/scatter plot, and donut chart with a pretty small code change.
Overall this is what I like most about the framework: the ability to get an app ready to run and easily make incremental improvements, all while keeping the code factored into manageable and often reusable chunks.</p><p>Also I wrote zero Javascript.</p><p>If you want to see the whole thing together in one script, the full source code for everything is already on <a href=https://github.com/timothyrenner/bigfoot-dash-app>GitHub</a>.</p><p>That&rsquo;s it - we&rsquo;re ready to rock.
Happy hunting.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.timothyrenner.github.io/>Timothy Renner</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>